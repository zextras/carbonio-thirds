targets=(
  "centos"
  "ubuntu"
)
pkgname="carbonio-openssl"
pkgver="1.1.1p"
pkgrel="1"
pkgdesc="Zextras's Secure Socket Layer build"
pkgdesclong=(
  "The Zextras OpenSSL build allows for secure communication between various processes."
)
arch="amd64"
maintainer="Zextras <packages@zextras.com"
url="https://zextras.com"
section="libs"
priority="important"
sources=(
  "https://www.openssl.org/source/openssl-${pkgver}.tar.gz"
)
hashsums=(
  "bf61b62aaa66c7c7639942a94de4c9ae8280c08f17d4eac2e44644d9fc8ace6f"
)

build() {
  cd "${srcdir}/openssl-${pkgver}"
  ./Configure no-idea enable-ec_nistp_64_gcc_128 no-mdc2 no-rc5 no-ssl2 \
    no-hw \
    no-tests \
    shared \
    no-ssl3-method \
    linux-x86_64 \
    -DOPENSSL_NO_HEARTBEATS \
    --prefix=/opt/zextras/common \
    --libdir=lib \
    --openssldir=/opt/zextras/common/etc/ssl
  LD_RUN_PATH=/opt/zextras/common/lib make depend
  LD_RUN_PATH=/opt/zextras/common/lib make all
}

package() {
  cd "${srcdir}/openssl-${pkgver}"
  LD_RUN_PATH=/opt/zextras/common/lib \
    MANDIR="/opt/zextras/common/share/man" \
    LIBS="" \
    make DESTDIR="${pkgdir}" install_sw install_ssldirs
  rm "${pkgdir}"/opt/zextras/common/lib/*.a
  rm "${pkgdir}"/opt/zextras/common/etc/ssl/misc/tsget*
  # rm -rf "${pkgdir}"/opt/zextras/common/include
}
