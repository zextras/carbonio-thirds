targets=(
  "centos"
  "ubuntu"
)
pkgname="carbonio-rrdtool"
pkgver="1.7.2"
pkgrel="2"
pkgdesc="Data logging and graphing application"
pkgdesclong=(
  "Data logging and graphing application"
)
arch="amd64"
maintainer="Zextras <packages@zextras.com"
url="https://zextras.com"
depends:apt=(
  "carbonio-libart"
  "carbonio-freetype"
  "carbonio-libpng"
  "carbonio-libxml2"
  "libpango-1.0-0"
)
makedepends:apt=(
  "libpango1.0-dev"
  "libpcre3-dev"
)
depends:yum=(
  "carbonio-libxml2"
  "pango"
)
makedepends:yum=(
  "pango-devel"
  "perl-core"
  "perl-devel"
  "zlib-devel"
)
section="utils"
priority="optional"
sources=(
#   "https://oss.oetiker.ch/rrdtool/pub/rrdtool-${pkgver}.tar.gz"
    "https://oss.oetiker.ch/rrdtool/pub/rrdtool-1.2.30.tar.gz"
)
hashsums=(
  "3190efea410a6dd035799717948b2df09910f608d72d23ee81adad4cd0184ae9"
)

build() {
  #cd "${srcdir}/rrdtool-${pkgver}"
  cd "${srcdir}/rrdtool-1.2.30"
  export LDFLAGS="-Wl,-rpath,/opt/zextras/common/lib"
  export CFLAGS="-fPIC"
  export PKG_CONFIG_PATH="/opt/zextras/common/lib/pkgconfig"

  ./configure --prefix=/opt/zextras/common \
    --disable-tcl --disable-ruby --disable-python \
    --with-perl-options="INSTALL_BASE=/opt/zextras/common LIB=/opt/zextras/common/lib/perl5 \
    LIBS='-L/opt/zextras/common/lib -lm -lpng -lz -lfreetype' INSTALLSITEMAN3DIR='/opt/zextras/common/share/man/man3'"
  make
}

package() {
  #cd "${srcdir}/rrdtool-${pkgver}"
  cd "${srcdir}/rrdtool-1.2.30"
  make DESTDIR="${pkgdir}" install
  rm -rf "${pkgdir}"/opt/zextras/common/share/rrdtool/examples
  rm -rf "${pkgdir}"/opt/zextras/common/lib/*.a
  rm -rf "${pkgdir}"/opt/zextras/common/lib/*.la
  find "${pkgdir}" -name '.packlist' -delete
  find "${pkgdir}" -name '*.pod' -delete
}
