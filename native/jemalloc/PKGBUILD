pkgname="carbonio-jemalloc"
pkgver="5.3.0"
pkgrel="2"
pkgdesc="General-purpose scalable concurrent malloc implementation"
arch=('x86_64')
license=("BSD-2-Clause")
section="mail"
priority="extra"
maintainer="Zextras <packages@zextras.com>"
url="https://github.com/zextras"
depends__apt=(
  "libgcc1"
  "libc6"
)
source=("https://github.com/jemalloc/jemalloc/releases/download/${pkgver}/jemalloc-${pkgver}.tar.bz2")
sha256sums=('2db82d1e7119df3e71b7640219b6dfe84789bc0537983c3b7ac4f7189aecfeaa')

build() {
  cd "${srcdir}/jemalloc-${pkgver}"
  ./configure \
    --enable-autogen \
    --prefix=/opt/zextras/common
  make -j16
}

package() {
  cd "${srcdir}/jemalloc-${pkgver}"

  make DESTDIR="${pkgdir}" install
  chmod 644 "${pkgdir}/opt/zextras/common/lib/libjemalloc_pic.a"
}
