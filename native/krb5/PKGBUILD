targets=(
  "centos"
  "ubuntu"
)
pkgname="carbonio-krb5"
pkgver="1.19.2"
pkgrel="1"
pkgdesc="The Kerberos network authentication system"
pkgdesclong=(
  "The Kerberos network authentication system"
)
arch="amd64"
maintainer="Zextras <packages@zextras.com"
url="https://zextras.com"
makedepends=(
  "bison"
)
section="utils"
priority="optional"
sources=(
  "https://web.mit.edu/kerberos/dist/krb5/1.19/krb5-${pkgver}.tar.gz"
  "krb5-config_LDFLAGS.patch"
)
hashsums=(
  "b90d6ed0e1e8a87eb5cb2c36d88b823a6a6caabf85e5d419adb8a930f7eea09a5f8491464e7e454cca7ba88be09d19415962fe0036ad2e31fc584f9fc0bbd470"
  "84007c7423f67db7a8b248b9643c49ef25f2d56ce15c2574eb41ecbf51bcd3f2"
)

build() {

  export LDFLAGS="-Wl,-rpath,/opt/zextras/common/lib -L/opt/zextras/common/lib -L/usr/lib/x86_64-linux-gnu -L/usr/lib"
  export CFLAGS=" -fPIC -fno-strict-aliasing -fstack-protector-all -I/opt/zextras/common/include -I/usr/include"
  export CPPFLAGS=" -fPIC -fno-strict-aliasing -fstack-protector-all -I/opt/zextras/common/include -I/usr/include"
  export PKG_CONFIG_PATH="/opt/zextras/common/lib/pkgconfig"

  cd "${srcdir}/krb5-${pkgver}"
  patch -Np1 -i ../krb5-config_LDFLAGS.patch
  cd src
  ./configure --prefix=/opt/zextras/common \
    --sbindir=/opt/zextras/common/bin \
    --sysconfdir=/opt/zextras/common/etc \
    --localstatedir=/opt/zextras/data \
    --enable-shared \
    --without-tcl \
    --enable-dns-for-realm \
    --without-readline \
    --without-ldap \
    --without-system-verto
   make -j16
}

package() {
  cd "${srcdir}/krb5-${pkgver}"/src
  make DESTDIR="${pkgdir}" install
}
