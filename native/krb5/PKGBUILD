pkgname="carbonio-krb5"
pkgver="1.21.2" # renovate: datasource=repology depName=arch/krb5
pkgrel="2"
pkgdesc="The Kerberos network authentication system"
arch=('x86_64')
maintainer="Zextras <packages@zextras.com>"
url="https://github.com/zextras"
license=("BSD-2-Clause")
makedepends=(
  "bison"
)
section="utils"
priority="optional"
source=(
  "https://web.mit.edu/kerberos/dist/krb5/${pkgver%.*}/krb5-${pkgver}.tar.gz"
)
sha256sums=('9560941a9d843c0243a71b17a7ac6fe31c7cebb5bce3983db79e52ae7e850491')

build() {

  export LDFLAGS="-Wl,-rpath,/opt/zextras/common/lib -L/opt/zextras/common/lib -L/usr/lib/x86_64-linux-gnu -L/usr/lib"
  export CFLAGS=" -fPIC -fno-strict-aliasing -fstack-protector-all -I/opt/zextras/common/include -I/usr/include"
  export CPPFLAGS=" -fPIC -fno-strict-aliasing -fstack-protector-all -I/opt/zextras/common/include -I/usr/include"
  export PKG_CONFIG_PATH="/opt/zextras/common/lib/pkgconfig"

  cd "${srcdir}/krb5-${pkgver}/src"

  ./configure --prefix=/opt/zextras/common \
    --sbindir=/opt/zextras/common/bin \
    --sysconfdir=/opt/zextras/common/etc \
    --localstatedir=/opt/zextras/data \
    --enable-shared \
    --enable-dns-for-realm \
    --without-readline \
    --without-ldap \
    --without-system-verto
  make -j16
}

package() {
  cd "${srcdir}/krb5-${pkgver}"/src
  make DESTDIR="${pkgdir}" install
}
