targets=(
    "centos"
    "ubuntu"
)
pkgname="carbonio-musl"
pkgver="1.2.2"
pkgrel="1"
pkgdesc="Lightweight implementation of C standard library"
pkgdesclong=(
  "Lightweight implementation of C standard library"
)
maintainer="Zextras <packages@zextras.com>"
arch="amd64"
license=("MIT")
url="https://www.musl-libc.org"
section="utils"
priority="optional"
sources=("https://www.musl-libc.org/releases/musl-${pkgver}.tar.gz")
hashsums=("9b969322012d796dc23dda27a35866034fa67d8fb67e0e2c45c913c3d43219dd")

build() {
    cd "musl-${pkgver}"
    ./configure \
        --exec-prefix=/opt/zextras/common \
        --prefix=/opt/zextras/common
    make -j16
}

package() {
    cd "musl-${pkgver}"
    
    make DESTDIR="${pkgdir}" install
    mv "${pkgdir}"/lib/ld-musl*.so* "${pkgdir}"/opt/zextras/common/lib/
    mv "${pkgdir}"/opt/zextras/common/lib/libc.so \
      "${pkgdir}"/opt/zextras/common/lib/libc.musl-x86_64.so.1
    rm -rf "${pkgdir}"/lib
    rm -rf "${pkgdir}"/opt/zextras/common/lib/*.a
    rm -rf "${pkgdir}"/opt/zextras/common/lib/*.la
    rm -rf "${pkgdir}"/opt/zextras/common/lib/*.o
    rm -rf "${pkgdir}"/opt/zextras/common/lib/*.specs
    rm -rf "${pkgdir}"/opt/zextras/common/include
}

