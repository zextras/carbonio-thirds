pkgname="carbonio-libsodium"
pkgver="1.0.19" # renovate: datasource=github-releases depName=jedisct1/libsodium
pkgrel="2"
pkgdesc="P(ortable|ackageable) NaCl-based crypto library"
arch=('x86_64')
maintainer="Zextras <packages@zextras.com>"
url="https://github.com/zextras"
license=('ISC')
section="libs"
priority="important"
source=(
  "https://github.com/jedisct1/libsodium/releases/download/${pkgver}-RELEASE/libsodium-${pkgver}.tar.gz"
)
sha256sums=('018d79fe0a045cca07331d37bd0cb57b2e838c51bc48fd837a1472e50068bbea')

build() {
  cd "${srcdir}/libsodium-stable"
  export LDFLAGS="-Wl,-rpath,/opt/zextras/common/lib"
  export PKG_CONFIG_PATH="/opt/zextras/common/lib/pkgconfig"

  ./configure --prefix=/opt/zextras/common
  make -j16
}

package() {
  cd "${srcdir}/libsodium-stable"
  make DESTDIR="${pkgdir}" install
  rm -rf "${pkgdir}"/opt/zextras/common/lib/*.a
  rm -rf "${pkgdir}"/opt/zextras/common/lib/*.la
}
